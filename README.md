# READ ME

## INTRODUCTION

This Readme file will help you in configuring the application and help in understanding the folder structure.

## CONFIGURATION

This section covers the process for configuring and installing the application packages.

1. Install `docker` in your system.
2. Add `.env` to your `root` directory, It has env.example file, you can copy same values to .env.
3. In root directory, run `docker compose up --build` to run the application for the first time, after that you can simply use `docker compose up` if no new npm packages are installed, node.js port is taken from env, takes some time to build :). `Make sure you have space left in your device for the application to install`
4. You can now access the server in 5000 port for nodejs and 5001 for admin database.

## For backend Documentation

Run `npm i` and `npm run doc` in root directory to generate a jsdoc, after generating, go to documentation/api directory and open index.html file for APIs documentation.

`NOTE: Seeder is already run along with migrations, so you can login using the admin credentials:`

`Admin Cred: admin@gmail.com admin`

# Database Documentation

This document provides an overview of the database schema for the system.
Below are the details of the main entities and their relationships within the database.

`NOTE: Every table has timestamps i.e created_at, updated_at and deleted_at for soft delete.`

## Entities and Relationships

### Users and auth related entities

#### roles table

- **id** (Primary Key): Unique identifier.
- **name**: Role type: mentor, student, admin.

#### users table

- **id** (Primary Key): Unique identifier
- **first_name**: User's first name.
- **last_name**: User's last name.
- **email**: The user's email address.
- **dob**: User's date of birth.
- **description**: User's description about himself.
- **password** (Nullable): password of the user if gone through normal registration(not oauth).
- **job_title**: What is the user currently doing? EG: student, lecturer, fulltime job, etc
- **profile_image** (Nullable): Users profile image.
- **jwt_token** (Nullable): Jwt Access token to know if the user is logged in currently or not.
- **phone_number**: Phone number of the user for OTP.

#### user_roles table

- **id** (Primary Key): Unique identifier.
- **user_id** (Foreign Key): References `users` table `id` column.
- **role_id** (Foreign Key): References `roles` table `id` column.

#### oauth_credentials table

- **id** (Primary Key): Unique identifier
- **user_id** (Foreign Key): Referencing `users` table.
- **provider**: Ex: linkedin, discord, facebook, gmail, etc
- **provider_user_id**: Id provided by the oauth providers
- **access_token**: Access token provided by the providers.
- **refresh_token**: Refresh token provided by the providers.
- **expires_at**: Expiry time of the token.

#### users_otp table

- **otp_token**: OTP token for the user
- **opt_expiry**: OTP Expiration time.
- **otp_verified** (default false): Boolean to save opt is verified or not.

### Files and Folders

This section covers the folder structures and the contents that you will find inside each folder.

All the main folders are inside src folder in root directory.

#### node_modules

- Default folder created by `npm i`.

#### node_modules

- Contains configs for database and other services.

#### controllers

- This folder contains sub folders that have business logic codes.
- The sub-folder name should be respective to the business logic inside it.
- The sub-folder may have multiple files related to similar business logics.
- The files inside the sub-folder should not contain huge chunks of code, use separate file inside the sub-folder in such case.
- In the index.js file of the main controllers folder, export all the functions from sub-folders to minimize imports in other folder.

#### queries

- This folder contains files which has the required Queries for the business logics.
- The file name should be respective to the queries inside it.
- Use Sequelize to run queries. Use raw query only when required.
- In the index.js file of the main queries folder, export all the classes from files to minimize imports in other folder.

#### routes

- This folder contains files which has APIs for business logics.
- This folder may contain multiple files to distinguish APIs.

#### migrations

- Auto generated by `npx sequelize-cli init`
- To create new migration `npx sequelize-cli migration:generate --name name_of_your_migration
- Migrations are generated inside the migrations folder.
- More information on Sequelize Migrations. [Sequelization](https://sequelize.org/master/manual/migrations.html)

#### seeders

- Auto generated by `npx sequelize-cli init`
- To create new migration `npx sequelize-cli seed:generate --name name_of_your_seeder
- Seeders are generated inside the seeders folder.
- More information on Sequelize. [Sequelization](https://sequelize.org/master/manual/migrations.html)

#### models

- Contains models for the database ORM.

#### services

- This folder contains external/third party services required in our application.

#### enums

- This folder contains files that define `CONSTANTS`.

#### exceptions

- This folder contains files that help in handeling Exceptions in the application. For Example: HttpsExceptions.
- The exceptions defined in these files are thrown through out the application using `TRY CATCH BLOCKS`.

#### helpers

- This folder contains sub-folder and files that have reusable functions.

#### middlewares

- This folder contains middlewares for the application such as error handling middleware and user authentication middleware.

#### templates

- This folder contains email and other templates required.

#### index.js

    - Handles app startup.
    - Handles routes.
    - Handles Global Variables.
    - Handles Middlewares.

The files below are at the root directory.

#### .env

    - Add all the environment variables inside this file.

#### Dockerfile

    - Docker configs in this file.

#### docker-compose.yml

    - Docker services configuration here.

#### .dockerignore

    - Add all files and folders to be ignored by docker setup in this file.

#### .gitignore

    - Add all files and folders to be ignored by git during commits.

#### .prettierrc

    - Config prettier
    - Modify prettier rules.

#### .sequelizerc Files

    - These files are used to config sequelizations.
    - These files names are used during migrations and generation of tables.

#### apidoc.json File

    - Config for our documentation

#### Use 'npm run doc' to generate apidoc.

# Happy Codding!
